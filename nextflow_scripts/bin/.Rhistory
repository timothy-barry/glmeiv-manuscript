args <- c("/Users/timbarry/research_code/glmeiv-manuscript/nextflow_scripts/bin/run_precomp.R", "/Users/timbarry/research_offsite/gasperini-2019/at-scale/processed/gene/gasp_scale_gene_expressions.odm", "/Users/timbarry/research_offsite/glmeiv/public/gasperini/data/gene_qc_metadata.rds", "/Users/timbarry/research_offsite/glmeiv/public/gasperini/data/covariate_matrix.rds", "/Users/timbarry/research_offsite/glmeiv/public/gasperini/data/m_offsets.rds", "ENSG00000174574", "ENSG00000102054", "ENSG00000112077")
args
n_args <- length(args)
n_args
odm_fp <- args[1L]
odm_fp
metadata_fp <- args[2L]
metadata_fp
metadata_fp <- args[2L]
metadata_fp
covariate_matrix_fp <- args[3L]
covariate_matrix_fp
args[3]
args[2]
args[1]
args <- args[-1]
args
odm_fp <- args[1L]
odm_fp
metadata_fp <- args[2L]
metadata_fp
covariate_matrix_fp <- args[3L]
covariate_matrix_fp
m_offsets_fp <- args[4L]
m_offsets_fp
ids <- args[seq(5L, n_args)]
ids
####################################################
# 2. Load ODM, covariate mat, and offset; set family
####################################################
odm <- read_odm(odm_fp = odm_fp, metadata_fp = metadata_fp)
########################################
# 1. Load packages and command-line args
########################################
library(ondisc)
####################################################
# 2. Load ODM, covariate mat, and offset; set family
####################################################
odm <- read_odm(odm_fp = odm_fp, metadata_fp = metadata_fp)
odm
covariate_matrix <- readRDS(covariate_matrix_fp)
covariate_matrix
offset <- readRDS(m_offsets_fp)
offset
fam_obj <- MASS::negative.binomial(NA)
fam_obj
id <- ids[1]
id
counts <- as.numeric(odm[[id,]])
counts
precomp <- glmeiv::run_glmeiv_precomputation(y = counts,
covariate_matrix = covariate_matrix,
offset = offset,
fam = glmeiv::augment_family_object(fam_obj))
precomp
precomp$covariate_coefs
precomp$fam
precomp$fam,
precomp$fam
